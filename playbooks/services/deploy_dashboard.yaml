---
- name: Deploy Infrastructure Dashboard
  hosts: metis
  become: yes

  pre_tasks:
    - name: Load services configuration
      include_vars:
        file: "{{ playbook_dir }}/../../config/services.yaml"
        name: services_data

    - name: Set variables for template
      set_fact:
        services: "{{ services_data.services }}"

  roles:
    - role: docker_service
      vars:
        service_name: dashboard
        compose_template: dashboard.compose.yml.j2
        service_directories:
          - www
          - www/favicons
        config_files:
          - src: dashboard.html.j2
            dest: www/index.html
        docker_compose_state: present

  tasks:
    - name: Copy favicon files
      ansible.builtin.copy:
        src: "{{ playbook_dir }}/../../static/favicons/"
        dest: /opt/dashboard/www/favicons/
        owner: root
        group: root
        mode: '0644'
