{
  # Global options for ACME with Cloudflare DNS-01 challenge
  email {{ acme_email }}
  acme_dns cloudflare {env.CLOUDFLARE_API_TOKEN}
}

(standard) {
  log {
    output file /logs/logging.txt {
    }
    format json
    level info
  }
}

### Ansible Managed Proxies - Do not modify anything below this line ###
{% for service in services.services %}
https://{{ service.url }} {
  reverse_proxy {{ service.protocol | default('http') }}://{{ service.machine }}:{{ service.port }} {
{% if service.tls_skip_verify | default(false) %}
    transport http {
      tls_insecure_skip_verify
    }
{% endif %}
  }
  import standard
}
{% endfor %}